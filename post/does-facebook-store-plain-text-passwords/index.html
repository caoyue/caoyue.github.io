<html lang="zh"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="default"/><meta name="format-detection" content="telephone=no"/><meta name="theme-color" content="#a6d6d6"/><meta name="msapplication-TileColor" content="#a6d6d6"/><meta name="msapplication-TileImage" content="/icon/favicon.ico"/><meta name="referrer" content="no-referrer"/><title>且听疯吟 / Does Facebook store plain-text passwords?</title><link rel="alternate" type="application/rss+xml" title="atom 1.0" href="/atom.xml"/><link rel="apple-touch-icon" sizes="192x192" href="/icon/favicon.ico"/><link rel="icon" type="image/png" sizes="48x48" href="/icon/favicon.ico"/><link rel="icon" type="image/png" sizes="192x192" href="/icon/favicon.ico"/><link rel="stylesheet" href="/css/normalize.css"/><link rel="stylesheet" href="/css/style.css"/><meta name="generator" content="Hexo 6.0.0"></head><body><div class="wrap"><div class="header"><a href="/" title="this is a link">且听疯吟</a><span>如此生活三十年</span></div><div class="left"><ul class="list"><li><a href="/" title="Home">Home</a></li><li><a href="/archives" title="archive">Archive</a></li><li><a href="/tags" title="Tags">Tags</a></li></ul></div><div class="right"><div class="entry" id="content"><div class="title">Does Facebook store plain-text passwords?</div><div class="content"><p>越来越多的网站开始更加关注安全问题了，比如，Facebook 会在你把密码从 <code>abc123</code> 改为 <code>Abc123</code> 的时候的时候提示你</p>
<blockquote>
<p>Your new password is too similar to your current password. Please try another password.</p>
</blockquote>
<p>很贴心是不是？但是，他们是怎么做到的？难道 Facebook 保存了用户的明文密码么？</p>
<h4 id="编辑距离"><a href="#编辑距离" class="headerlink" title="编辑距离"></a>编辑距离</h4><p>计算两个字符串的相似性，或者说「编辑距离」很容易，我们有很多现成的算法和代码。<br>但是，显然 Facebook 不会傻到存储明文密码，存储的肯定是 <code>hash(&quot;abc123&quot;)</code>。<br>而字符串中的差别和 hash 结果并不是一一对应的。两个相近的字符串，其 hash 结果可能差别很大。</p>
<h4 id="simhash"><a href="#simhash" class="headerlink" title="simhash"></a>simhash</h4><p>可能你听说过 simhash 算法。Google 就是使用这种算法来做网页查重的。<br>传统的 hash 算法如 md5，一般尽可能要求结果分布均匀，因此，原始字符串的微小变动也会导致 hash 结果出现很大差异。<br>而 simhash 是一种局部敏感的 hash 算法，选定位数，提取特征，然后对每一段特征值计算 hash，然后将每一段值处理到 simhash 结果，得到最后的 simhash 值。比较海明距离就可以大概知道两个文档的相似度了。<br>具体的算法懂得不多就不瞎说了……大概可以推测，对于长文档这种方法是有效的，但是对于短文本，如 password 来说，效果可能不会太好。</p>
<h4 id="Facebook-的做法"><a href="#Facebook-的做法" class="headerlink" title="Facebook 的做法"></a>Facebook 的做法</h4><p>事实上这个问题好奇的人也很多，Stack Exchange 上有一个回答 <a target="_blank" rel="noopener" href="http://security.stackexchange.com/questions/53481/does-facebook-store-plain-text-passwords">http://security.stackexchange.com/questions/53481/does-facebook-store-plain-text-passwords</a>，下面有一个自称接触过密码验证这部分代码的人肯定了这个猜测。<br>我觉得这种做法看起来还是挺合理的。</p>
<p>Facebook 用了一种看起来很「土」的方法，操作方法类似这样：</p>
<ol>
<li>用户注册，密码 <code>abc123</code>，Facebook 保存了 &#96;hash(“abc123”)</li>
<li>用户修改密码，提交新密码 <code>Abc123</code></li>
<li>Facebook 拿到新密码，根据这个密码，生成一堆类似于 <code>ABC123</code>，<code>abc123</code> 这样相近的密码，使用同样的 hash 方法，去和 1 中的 hash 比对，一旦发现有相同的，那么可以判定新密码与旧密码是相似的。</li>
</ol>
<p>很好的反向思维，不是去计算相似性，而是通过生成一堆相似密码来「暴力」尝试。</p>
<h4 id="其他想法"><a href="#其他想法" class="headerlink" title="其他想法"></a>其他想法</h4><p>事实上最初想到这个问题的时候，我考虑过这样的做法：</p>
<ol>
<li>用户修改密码操作时，提示输入原密码</li>
<li>server 临时记录用户的原密码</li>
<li>用户输入新密码，server 比对新旧密码</li>
<li>完成修改或过期后，销毁临时记录</li>
</ol>
<p>不过即使是临时记录依然可能存在风险，如果需要较高的安全性的话这种方法是不可取的。</p>
</div><div><ul class="info"><li>posted on 2015-09-02<li><a href="/tags/programming/">#programming</a></li></li></ul></div></div><div id="disqus_thread"></div><script>var disqus_config = function () {
    this.page.url = "https://blog.caoyue.me/post/does-facebook-store-plain-text-passwords/";
    this.page.identifier = "post/does-facebook-store-plain-text-passwords/";
};

(function() {
    var d = document, s = d.createElement('script');
    s.src = 'https://caoyue.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
})();</script></div><div class="footer"><div></div>©2021<a href="https://blog.caoyue.me"> 且听疯吟</a>. designed by<a href="https://caoyue.me" target="_blank"> caoyue</a>. powered by<a href="https://hexo.io/" target="_blank"> hexo</a></div><script defer src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon='{"token": "1a24e73fd4284bfa8b43ecf5a5c2c100"}'></script>
</div></body></html>